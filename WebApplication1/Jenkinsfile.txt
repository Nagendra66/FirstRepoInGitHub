node
{
stage('Checkout') 
    {
		//Checkout the latest code from source controller
		git 'https://github.com/Nagendra66/FirstRepoInGitHub.git'
		//Bundle the Code and packakging
        bat 'C:/Tools/nuget.exe restore WebApplication1/WebApplication1.sln'
    }
    stage('Build')
    {
		try{
			notifyBuildStatus('STARTED')
			//Build the Solution
			bat '"C:\\Program Files (x86)\\MSBuild\\14.0\\Bin\\MSBuild.exe"  "WebApplication1/WebApplication1.sln" /t:clean /p:Configuration=Release /p:VisualStudioVersion=14.0 /p:DeployOnBuild=true /t:Rebuild /p:GenerateSerializationAssemblies=Off'
			}
			catch(e){
				// If there was an exception thrown, the build failed
				currentBuild.result = "FAILED"
				throw e
			}
			finally{
				// Success or failure, always send notifications
			notifyBuildStatus(currentBuild.result)
			}
    }
}

def notifyBuildStatus(String buildStatus = 'STARTED') {
  // build status of null means successful
  buildStatus =  buildStatus ?: 'SUCCESSFUL'
 
  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"
  def details = """<p>STARTED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':</p>
    <p>Check console output at "<a href="${env.BUILD_URL}">${env.JOB_NAME} [${env.BUILD_NUMBER}]</a>"</p>"""
 
  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESSFUL') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }
 
  // Send notifications
  emailext (
      subject: subject,
      body: details,
      to: 'dnagendra@mirabeltechnologies.com'
    )
}